{% extends 'base.html' %}
{% load static %}
{% block content %}

    <link rel="stylesheet" href="{% static 'admin/style.css' %}">
    <div class="admin-admin-wrapper">

        {% with 'tags' as active_page %}
            {% include 'admin/admin_sidebar.html' %}
        {% endwith %}

        <main class="admin-main-content">

            <div class="admin-content-header">
                <h1>Tags Management {% if not user.is_superuser %}
                    <span style="color: #dc3545;">No Permission</span>{% endif %}</h1>

                <button class="admin-btn admin-btn-primary" id="add_tag">Add New Tag</button>

            </div>

            <div class="admin-search-container">
                <input type="text" placeholder="Search by title, author, etc.">
                <button class="admin-btn admin-btn-primary">Search</button>
            </div>

            <div class="admin-book-list">

                <div class="admin-tag-list-header">
                    <div>id</div>
                    <div>Tag</div>
                    <div class="admin-actions">Actions</div>
                </div>


                {% for tag in page_obj %}


                    <div class="admin-tag-list-item">
                        <div data-label="Title">{{ tag.id }}</div>
                        <div data-label="Author">{{ tag.name }}</div>
                        <div class="admin-actions">
                            <a class="admin-btn admin-btn-edit">Edit</a>
                            <form method="POST"
                                  action="{% url 'admin_tag_delete' %}"
                                  style="display: inline;">

                                {% csrf_token %}
                                <input type="hidden" name="id" value="{{ tag.id }}">
                                <button type="submit"
                                        class="admin-btn admin-btn-danger"

                                        onclick="return confirm('Are you sure you want to delete the tag {{ book.title }}? This action cannot be undone!');">

                                    Delete

                                </button>


                            </form>
                        </div>
                    </div>
                {% empty %}
                    <p>No content.</p>

                {% endfor %}


                <nav class="admin-pagination">

                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}">Previous</a>
                    {% else %}
                        <a href="#" class="admin-disabled" onclick="return false;">Previous</a>
                    {% endif %}

                    {% for i in page_obj.paginator.get_elided_page_range %}

                        {% if i == page_obj.paginator.ELLIPSIS %}
                            <span>...</span>

                        {% elif i == page_obj.number %}
                            <a href="#" class="admin-active">{{ i }}</a>

                        {% else %}
                            <a href="?page={{ i }}">{{ i }}</a>

                        {% endif %}

                    {% endfor %}

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}">Next</a>
                    {% else %}
                        <a href="#" class="admin-disabled" onclick="return false;">Next</a>
                    {% endif %}
                </nav>
            </div>
        </main>
    </div>

    <div id="tagadd-overlay">
        <div class="progress-box">
            <h3 style="color: #059377;margin-bottom: 20px;">Add Tag</h3>
            <form class="tagadd-content" action="{% url 'admin_tag_add' %}" method="post">
                {% csrf_token %}
                <input type="text" id="tagname" placeholder="Tag Name" name="name">
                <input type="submit" class="tagadd-contentbtn" id="tagadd-contentsub">
                <button class="tagadd-contentbtn" id="tagadd-contentclose" type="button">Close</button>
            </form>
        </div>
    </div>

    <div id="tagedit-overlay">
        <div class="progress-box">
            <h3 style="color: #059377;margin-bottom: 20px;">Edit Tag</h3>
            <form class="tagadd-content" action="{% url 'admin_tag_edit' %}" method="post">
                {% csrf_token %}
                <input type="hidden" id="tagid_edit" name="id">
                <input type="text" id="tagname_edit" placeholder="Tag Name" name="name">
                <input type="submit" class="tagadd-contentbtn" id="tagedit-contentsub">
                <button class="tagadd-contentbtn" id="tagedit-contentclose" type="button">Close</button>
            </form>
        </div>
    </div>

    <script>
        $().ready(function () {
            $("#add_tag").click(function () {
                $("#tagadd-overlay").css('display', 'flex');
            })

            $("#tagadd-contentclose").click(function () {
                $("#tagadd-overlay").css('display', 'none');
            })

            $(".admin-btn-edit").click(function () {
                var $item = $(this).closest('.admin-tag-list-item');

                // 2. 在父容器内查找对应的数据元素
                // 使用 .find() 结合 data-label 属性或者是类名、位置来定位
                // 注意：这里使用了 .text().trim() 来获取文本并去除可能存在的首尾空格
                var tagId = $item.find('div[data-label="Title"]').text().trim();
                var tagName = $item.find('div[data-label="Author"]').text().trim();
                $("#tagedit-overlay").css('display', 'flex');
                $("#tagname_edit").val(tagName);
                $("#tagid_edit").val(tagId);
            })

            $("#tagedit-contentclose").click(function () {
                $("#tagedit-overlay").css('display', 'none');
            })
        })
    </script>
{% endblock %}